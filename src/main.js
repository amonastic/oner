//å¯¼å…¥expressåŒ…
const express = require('express');
//åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œå»æ‰§è¡Œexpress
const app = express();
//å®šä¹‰ä¸€ä¸ªæœåŠ¡ç«¯å£
const port = 3000;

/**
*   ä½¿ç”¨JSONä¸­é—´ä»¶
*/
//useï¼šåœ¨æŒ‡å®šçš„åœ°æ–¹ä½¿ç”¨ä¸­é—´ä»¶ï¼Œè‹¥ä¸ºåˆ¶å®šuseçš„å†…å®¹é‚£ä¹ˆå°†å…¨å±€ä½¿ç”¨ï¼Œè¿™é‡ŒæŒ‡å®šäº†expressæ–¹æ³•
app.use(express.json());

//ä½¿ç”¨appçš„listenï¼Œå†…å®¹æ˜¯ç›‘å¬çš„ç«¯å£portï¼Œåœ¨è¾“å…¥ä¸€ä¸ªå‡½æ•°
app.listen(port, () => {
    console.log('ğŸš€ æœåŠ¡å·²å¯åŠ¨ï¼');
});

//GETæ–¹æ³•å¯ä»¥å®šä¹‰ä¸€æ¡æ”¯æŒHTTPçš„GETæ–¹æ³•è¯·æ±‚çš„æ¥å£ï¼Œå‘å‡ºè¯·æ±‚ä¹‹åï¼Œé™¤äº†åœ°å€è¿˜éœ€è¦è¯´æ˜ä¸€ä¸ªç‰¹å®šçš„HTTPæ–¹æ³•
//ä½¿ç”¨GETé‚£å°±åªæ”¯æŒgetï¼Œä¸€èˆ¬å®¢æˆ·ç«¯éƒ½æ˜¯ä½¿ç”¨getå‘å‡ºè¯·æ±‚
//è®¾ç½®æ¥å£çš„åœ°å€â€˜/â€™ï¼Œå³è¯·æ±‚ä½¿ç”¨è¿™ä¸ªæ¥å£
//åé¢æ˜¯è¯´æ˜è¦åšçš„äº‹æƒ…ï¼Œæ”¾åœ¨æ¥å£å¤„ç†å™¨é‡Œé¢ï¼Œ()-å¤„ç†å™¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‡Œé¢çš„å‚æ•°æœ‰è¯·æ±‚å’Œå“åº”
app.get('/', (request, response) => {
    //ä½¿ç”¨å“åº”çš„sendæ–¹æ³•ä»¥å“åº”å®¢æˆ·ç«¯ï¼Œå“åº”çš„æ•°æ®äº¤ç»™è¿™ä¸ªæ–¹æ³•
    response.send('ä½ å¥½ ~');
});

const data = [
    {
        id:1,
        title:'å…³å±±æœˆ',
        content:'æ˜æœˆè‹å±±'
    },
    {
        id:2,
        title:'å…³å±±',
        content:'æœˆå‡ºè‹å±±'
    },
    {
        id:3,
        title:'å±±æœˆ',
        content:'æ˜æœˆå‡º'
    }
];

app.get('/posts', (request, response) => {
    response.send(data);
});

///post/:postIdï¼Œ:åé¢å¸¦çš„æ˜¯idï¼Œä¸æ˜¯å­é¡µé¢ï¼ŒPostIDå°±æ˜¯å‚æ•°åå­—ï¼Œæ¥å£å¤„ç†å™¨å¯ä»¥é€šè¿‡postIDå¾—åˆ°å‚æ•°çš„å€¼
//å¯ä»¥ä½¿ç”¨å¤šä¸ªå‚æ•°ï¼Œä½¿ç”¨æ–œçº¿åˆ†å‰²å³å¯
app.get('/posts/:postID', (request, response) => {
    //è·å–ID,å‚æ•°éƒ½æ˜¯åœ¨paramsä¸­
    const { postID } = request.params;

    //æŸ¥æ‰¾å…·ä½“çš„idå†…å®¹,filteråˆ¶é€ å‡ºæ¥çš„æ˜¯æ•°ç»„
    const post = data.filter(item => item.id = postID );

    //åšå‡ºå“åº”çš„æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œ0ä»£è¡¨ç¬¬ä¸€ä¸ªé¡¹ç›®
    response.send(post[0]);
});

/**
 * åˆ›å»ºå†…å®¹
 */

//è®¾ç½®æ¥å£å’Œæ¥å£å†…å®¹ï¼Œè®¾ç½®è¯·æ±‚å’Œå“åº”å¤„ç†å™¨
app.post('/posts', (request, response) => {

    //è·å–å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®ï¼Œbodyçš„ä¸œè¥¿å°±æ˜¯å®¢æˆ·ç«¯åœ¨è¯·æ±‚é‡Œçš„æ•°æ®
    const { content } = request.body;

    // è®¾ç½®å“åº”çŠ¶æ€ç ï¼Œåœ¨å“åº”ä¹‹å‰è®¾ç½®çŠ¶æ€ç ï¼Œåœ¨sendä¹‹å‰
    response.status(201);

    //è¾“å‡ºå®¢æˆ·ç«¯è¯·æ±‚çš„å¤´éƒ¨æ•°æ®
    console.log(request.headers['sing-along']);

    //è®¾ç½®å“åº”çš„å¤´éƒ¨æ•°æ®
    response.set('Sing-Along', 'this is server headers data');

//çœŸå®åº”ç”¨éœ€è¦æ”¾æ•°æ®ä»“åº“ï¼Œç°åœ¨æ˜¯æ¼”ç¤ºï¼Œæ‰€ä»¥ç›´æ¥å“åº”
    //åšå‡ºå“åº”ï¼Œè®¾ç½®å“åº”çš„å¯¹è±¡
    response.send({
        message: `åˆ›å»ºäº†å†…å®¹: ${ content } `
    });
});